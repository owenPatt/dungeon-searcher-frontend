const challengePerLevel = [
  [0.1, 0.2, 0.25, 0.5, 1, 2.1], // 1
  [0.07, 0.125, 0.2, 0.4, 0.6, 1, 1.5], // 2
  [0.05, 0.085, 0.12, 0.3, 0.5, 0.7, 1, 1.5, 2], // 3
  [0.02, 0.071, 0.1, 0.16, 0.33, 0.5, 0.7, 1, 1.5, 2], // 4
  [0.015, 0.05, 0.072, 0.12, 0.18, 0.36, 0.5, 0.65, 0.8, 1, 1.1, 1.5, 2], // 5
  [
    0.01, 0.015, 0.0625, 0.09, 0.14, 0.3, 0.4, 0.5, 0.65, 0.8, 0.9, 1.3, 1.6, 2,
    2.3,
  ], // 6
  [
    0.01, 0.01, 0.05, 0.077, 0.15, 0.25, 0.33, 0.45, 0.6, 0.75, 0.9, 1, 1.35,
    1.6, 1.9, 2.3,
  ], // 7
  [
    0, 0, 0.05, 0.07, 0.11, 0.2, 0.33, 0.4, 0.5, 0.6, 0.7, 0.9, 1.1, 1.3, 1.5,
    1.8, 2.1,
  ], // 8
  [
    0, 0, 0.025, 0.067, 0.09, 0.2, 0.25, 0.35, 0.45, 0.55, 0.65, 0.8, 0.9, 1,
    1.3, 1.5, 1.7, 2,
  ], // 9
  [
    0, 0, 0.02, 0.055, 0.08, 0.15, 0.2, 0.33, 0.45, 0.55, 0.67, 0.75, 0.9, 1,
    1.1, 1.3, 1.5, 1.8, 2,
  ], // 10
  [
    0, 0, 0.015, 0.05, 0.08, 0.125, 0.17, 0.25, 0.38, 0.47, 0.55, 0.65, 0.75,
    0.85, 0.95, 1.1, 1.3, 1.45, 1.6, 1.8, 2,
  ], // 11
  [
    0, 0, 0.01, 0.045, 0.07, 0.11, 0.16, 0.2, 0.35, 0.4, 0.48, 0.6, 0.65, 0.7,
    0.8, 0.9, 0.98, 1.1, 1.3, 1.5, 1.8, 2, 2.1,
  ], // 12
  [
    0, 0, 0, 0.04, 0.062, 0.1, 0.14, 0.17, 0.3, 0.35, 0.4, 0.55, 0.62, 0.69,
    0.75, 0.82, 0.91, 0.98, 1.1, 1.2, 1.4, 1.6, 1.9, 2,
  ], // 13
  [
    0, 0, 0, 0.038, 0.056, 0.09, 0.125, 0.16, 0.25, 0.33, 0.38, 0.5, 0.56, 0.63,
    0.7, 0.79, 0.87, 0.93, 1, 1.1, 1.3, 1.5, 1.6, 1.8,
  ], // 14
  [
    0, 0, 0, 0.032, 0.05, 0.08, 0.11, 0.15, 0.23, 0.29, 0.34, 0.48, 0.5, 0.57,
    0.63, 0.7, 0.84, 0.9, 0.97, 1, 1.2, 1.3, 1.5, 1.6,
  ], // 15
  [
    0, 0, 0, 0.028, 0.048, 0.077, 0.1, 0.145, 0.2, 0.25, 0.33, 0.42, 0.48, 0.5,
    0.56, 0.61, 0.73, 0.84, 0.9, 0.97, 1, 1.2, 1.3, 1.4,
  ], // 16
  [
    0, 0, 0, 0.02, 0.045, 0.07, 0.09, 0.125, 0.17, 0.2, 0.28, 0.39, 0.44, 0.48,
    0.54, 0.6, 0.65, 0.72, 0.8, 0.89, 0.95, 1, 1.1, 1.3,
  ], // 17
  [
    0, 0, 0, 0.01, 0.04, 0.065, 0.08, 0.11, 0.14, 0.18, 0.24, 0.35, 0.4, 0.45,
    0.5, 0.56, 0.6, 0.68, 0.74, 0.82, 0.9, 0.95, 1, 1.1,
  ], // 18
  [
    0, 0, 0, 0, 0.036, 0.06, 0.07, 0.1, 0.12, 0.16, 0.2, 0.25, 0.3, 0.4, 0.48,
    0.5, 0.56, 0.62, 0.69, 0.76, 0.84, 0.9, 0.95, 1,
  ], // 19
  [
    0, 0, 0, 0, 0.03, 0.5, 0.065, 0.08, 0.1, 0.12, 0.16, 0.2, 0.25, 0.32, 0.36,
    0.43, 0.5, 0.59, 0.64, 0.7, 0.75, 0.8, 0.86, 0.93,
  ], // 20
];

const getMonsterIndex = (cr) => {
  if (cr === 0) return 0;
  else if (cr === 0.125) return 1;
  else if (cr === 0.25) return 2;
  else if (cr === 0.5) return 3;
  else return cr + 3;
};

const calculateChallengeRating = (partyLevel, selectedResults) => {
  let totalChallenge = 0;
  for (let i = 0; i < selectedResults.length; i++) {
    const monster = selectedResults[i];
    const monsterChallenge = monster.cr;
    let monsterIndex = getMonsterIndex(monsterChallenge);
    if (
      !challengePerLevel[partyLevel - 1][monsterIndex] &&
      challengePerLevel[partyLevel - 1][monsterIndex] !== 0
    )
      return "TPK In coming!";
    totalChallenge += challengePerLevel[partyLevel - 1][monsterIndex];
  }

  if (totalChallenge >= 0 && totalChallenge < 0.5) {
    return "Super Easy";
  } else if (totalChallenge >= 0.5 && totalChallenge < 0.8) {
    return "Easy";
  } else if (totalChallenge >= 0.8 && totalChallenge < 1.2) {
    return "Medium";
  } else if (totalChallenge >= 1.2 && totalChallenge < 1.7) {
    return "Hard";
  } else if (totalChallenge >= 1.7 && totalChallenge <= 2) {
    return "Deadly";
  } else if (totalChallenge > 2) {
    return "TPK In coming!";
  }
};

export default calculateChallengeRating;
